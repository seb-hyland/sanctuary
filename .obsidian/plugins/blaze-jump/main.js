/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var G=Object.defineProperty;var bt=Object.getOwnPropertyDescriptor;var ft=Object.getOwnPropertyNames;var wt=Object.prototype.hasOwnProperty;var kt=(h,r)=>{for(var t in r)G(h,t,{get:r[t],enumerable:!0})},xt=(h,r,t,e)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of ft(r))!wt.call(h,i)&&i!==t&&G(h,i,{get:()=>r[i],enumerable:!(e=bt(r,i))||e.enumerable});return h};var vt=h=>xt(G({},"__esModule",{value:!0}),h);var Dt={};kt(Dt,{default:()=>W});module.exports=vt(Dt);var T=class{constructor(){this.state={plugin_draw_observers:[],plugin_draw_callback:function(){if(!(!this.plugin_draw_observers||this.plugin_draw_observers.length<=0))for(let r of this.plugin_draw_observers)r==null||r.fn()}}}static getInstance(){return T.instance||(T.instance=new T),T.instance}},y=T.getInstance();var z=require("obsidian");var Q=(h,r)=>{let t=r.layout_characters.indexOf(h.toLowerCase());t<=-1&&(t=Math.floor(r.layout_characters.length/2));let e=Math.floor(t/r.layout_width);return[t-r.layout_width*e,e]},M=(h,r,t)=>h<0||r<0||r>=t.layout_height||h>=t.layout_width?null:t.layout_characters[h+t.layout_width*r];var Ct=(h,r,t,e)=>{let i=r>0?1:0,[a,s]=h;return a-i<0||a<0?s-i<0||s<0?[t-1,e-1,1]:[t-1,s-i,1]:[a-i,s,1]},$=class{constructor(){this.keyboard_layouts=[]}initialize(r){return this.keyboard_layouts=r,this}next_char(r,t,e,i,a){let s=this.keyboard_layouts[i];return Ct(r,e,s.layout_width,s.layout_height)}static getInstance(){return $.instance||($.instance=new $),$.instance}},it=$.getInstance();var Lt=(h,r,t,e)=>{let i=r>0?1:0,[a,s]=h;return a+i>=t||a>=t?s+i>=e||s>=e?[0,0,1]:[0,s+i,1]:[a+i,s,1]},P=class{constructor(){this.keyboard_layouts=[]}initialize(r){return this.keyboard_layouts=r,this}next_char(r,t,e,i,a){let s=this.keyboard_layouts[i];return Lt(r,e,s.layout_width,s.layout_height)}static getInstance(){return P.instance||(P.instance=new P),P.instance}},rt=P.getInstance();var Tt=(h,r,t)=>{let e=r[0]-t,i=r[1]-t,a=r[0]+t,s=r[1]+t,[n,c]=h,u=n,_=c;return t<=0?[r[0],r[1],1]:t<=1&&n===r[0]&&c===r[1]?[r[0]-1,r[1]-1,1]:(n===e&&c<=s&&c>i?(_=c-1,u=n):n===a&&c>=i&&c<s?(_=c+1,u=n):c===i&&n>=e&&n<a?(u=n+1,_=c):c===s&&n<=a&&n>e&&(u=n-1,_=c),u===e&&_===i?[e-1,i-1,t+1]:[u,_,t])},V=(h,r,t,e,i,a=0)=>{let[s,n]=r,[c,u]=h;if(c>=0&&u>=0&&c<e&&u<i)return[...h,t];if(s-t<0&&s+t>e&&n-t<0&&n+t>i)return[...r,-1];if(a>100)return console.warn("overflow",[...r,-1]),[...r,-1];let _=c,d=u,g=t;return c<0?(c===s-t&&u===n-t||(g=t+1,_=s-g,d=n-g),d>=0?_=0:d<0&&(_=s+g),V([_,d],[s,n],g,e,i,a+1)):u<0?(_=s+g,_<e?d=0:_>=e&&(d=n+g),V([_,d],[s,n],g,e,i,a+1)):c>=e?(d=n+g,d<i?_=e-1:d>=i&&(_=s-g),V([_,d],[s,n],g,e,i,a+1)):u>=i?(_=s-g,_>=0&&(d=i-1),V([_,d],[s,n],g,e,i,a+1)):[...h,t]},$t=(h,r,t,e,i,a=-1)=>{let[s,n,c]=Tt([...h],[...r],t),[u,_,d]=V([s,n],[...r],c,e,i);return a>0&&d>a?[...r,-1]:[u,_,d]},S=class{constructor(){this.keyboard_layouts=[]}initialize(r){return this.keyboard_layouts=r,this}next_char(r,t,e,i,a){let s=this.keyboard_layouts[i];return $t(r,t,e,s.layout_width,s.layout_height,a)}static getInstance(){return S.instance||(S.instance=new S),S.instance}},H=S.getInstance();var Pt=(h,r,t,e)=>{if(r<=0)return[0,0,1];let[i,a]=h;return i+1>=t||i>=t?a+1>=e||a>=e?[0,0,1]:[0,a+1,1]:[i+1,a,1]},E=class{constructor(){this.keyboard_layouts=[]}initialize(r){return this.keyboard_layouts=r,this}next_char(r,t,e,i,a){let s=this.keyboard_layouts[i];return Pt(r,e,s.layout_width,s.layout_height)}static getInstance(){return E.instance||(E.instance=new E),E.instance}},ot=E.getInstance();var X={spiral:H,plain:ot,forward:rt,backward:it},at=h=>{try{let r=X[`${h}`.toLowerCase()];return r!=null?r:H}catch(r){return console.error("Error providing heuristic, using fallback version instead",r),H}},nt=()=>Object.keys(X).filter(h=>X.hasOwnProperty(h));var O=(h,r,t,e,i)=>({id:h,value:e,children:i,parent:r!=null?r:null,context:t!=null?t:{position:void 0,full:!1,counter:0,depth:0},get full_id(){let a=this.rec_id;if(a)return a;if(!this.parent)return this.rec_id=this.id,this.id;let s=`${this.parent.full_id}${this.id}`;return this.rec_id=s,s}}),St=(h,r)=>{if(!h.children||h.children.length<=0)return;let t=h.children;for(let e of t)if(e.id===r)return e},Et=h=>{var t,e;let r=(t=h.children)==null?void 0:t.pop();if(!r)throw"Impossible! Last node not exists!";return(e=h.children)==null||e.unshift(r),h},lt=(h,r=0,t=100)=>{if(r>t)throw"Overflow";return!h.children||(Et(h),h.context.counter-=1,h.context.counter>0)?h:(h.context.counter=h.children.length,h.context.full=!0,h.parent?lt(h.parent,r+1):h)},ct=(h,r=[],t=0,e=1e3)=>{if(t>e)throw"Overflow";let i=h.children;if(!i)return h.value&&r.push(h),r;for(let a of i)r=ct(a,r,t+1,e);return r},F=class{constructor(r,t,e,i){this.layouts=[];for(let a of t)this.layouts.push(F.initKeyboardLayout(a,e));this.heuristic=r.initialize(this.layouts),this.search_node=O("#"),this.layout_depth=i}static initKeyboardLayout(r,t){let e=`${r}`.toLowerCase().trim().split(/\s+|\n+/),i=e.reduce((u,_)=>Math.max(u,_.length),0),a=[...`${r}`.toLowerCase().trim()],s=e.reduce((u,_)=>[...u,..._,...Array(i-_.length).fill(null)],[]).map(u=>`${t}`.toLowerCase().includes(u)?null:u).map(u=>u!=="#"?u:null),n=e.length;return{layout_characters:s,layout_original:a,layout_width:i,layout_height:n}}next_key(r,t,e,i){var n;let[a,s]=Q(t,(n=this.layouts[r])!=null?n:this.layouts[0]);return this.next_key_xy(r,[a,s],e,i)}next_key_xy(r,t,e,i){var b;let[a,s]=t,n=i?[...i]:void 0,c=e!=null?e:0,u=(b=this.layouts[r])!=null?b:this.layouts[0],_=Math.min(Math.pow(1+Math.max(0,c)*2,2)+1,(u.layout_height+u.layout_width)*2),d=null,g=0;for(;;){if(g>_)throw console.error("max spin"),"Max spin";let[o,l,p]=this.heuristic.next_char(n!=null?n:[a,s],[a,s],c,r,this.layout_depth);if(d=M(o,l,u),n=[o,l],c=p,d!==null)break}return[d,n,c]}add_node(r,t,e,i,a,s=0,n=100){var g,b;if(s>=n)throw i.context.depth=-1,"Stack overflow";if(i.context.full){if(!i.children||i.children.length<=0)throw"Impossible state, full node MUST contain children";let o=i.children[0];return this.add_node(r,o.id,e,o,a,s+1,n)}let[c,u,_]=this.next_key(r,t,i.context.depth,i.context.position);if(i.context.position=u,i.context.depth=_,i.value){let[o,l,p]=this.next_key(r,i.id),m={position:l,depth:p,counter:0,full:!1},f=O(i.id,i,m,i.value);i.children=[...(g=i.children)!=null?g:[],f],i.value=void 0}if(!St(i,c)){if(!i.children&&i.parent)return i.value=e,i;!i.parent&&!i.children&&(i.value=void 0,i.children=[]);let[o,l,p]=this.next_key(r,c),f=O(c,i,{position:l,depth:p,counter:0,full:!1},e);return(b=i.children)==null||b.push(f),i.value=void 0,i}if(!i.context.full)return lt(i),this.add_node(r,t,e,a,a,s+1,n);if(!i.children||i.children.length<=0)throw"Impossible state, full node MUST contain children";let d=i.children[0];return this.add_node(r,d.id,e,d,a,s+1,n)}assign(r,t,e){let i=e!=null?e:this.recognize_layout(r);this.add_node(i,r,t,this.search_node,this.search_node)}narrow(r){let t=this.search_node;if(t.id===r&&(!t.children||t.children.length<=0))return this.search_node=t,this.search_node;if(!t.children||t.children.length<=0)return this.reset(),this.search_node;for(let e of t.children)if(e.id===r)return this.search_node=e,this.search_node;return this.reset(),this.search_node}freeze_nodes(){return ct(this.search_node)}mid_layout_char(r){var _;let t=(_=this.layouts[r])!=null?_:this.layouts[0],e=this.layouts[r]?r:0,i=Math.floor(t.layout_width/2),a=Math.floor(t.layout_height/2),s=M(i,a,t);if(s)return s;let[n,c,u]=this.next_key_xy(e,[i,a]);return n&&u>=0?n:(console.warn("No allowed characters found"),"h")}recognize_layout(r,t=-1){try{if(t>=0&&this.layouts[t].layout_original.indexOf(r.toLowerCase())>=0)return t;for(let e=0;e<this.layouts.length;e++){if(t>=0&&e===t)continue;if(this.layouts[e].layout_original.indexOf(r.toLowerCase())>=0)return e}}catch(e){return console.error(`unknown layout for input: ${r}`,e),0}return console.warn(`unknown layout for input ${r}`),0}reset(){this.search_node=O("#")}};var j=require("@codemirror/view");var ut=require("@codemirror/view"),N=class extends ut.WidgetType{constructor(t,e){super();this.position=t,this.style=e}toDOM(t){var n,c;let e=this.position.coord.left-this.position.origin.left,i=this.position.coord.top-this.position.origin.top;if(!document.getElementById(N.style_id)){let u=document.createElement("style");u.id=N.style_id,u.textContent=`                  
                    .blaze-jump-widget-pulse {
                      animation: blaze-jump-pulse-pointer ${(n=this.style.duration)!=null?n:.15}s 1 forwards;
                      background-color: ${(c=this.style.bg)!=null?c:"red"};
                    }
                `,document.head.appendChild(u)}let s=document.createElement("span");return s.className="blaze-jump-widget-pulse",s.style.left=`${e}px`,s.style.top=`${i}px`,s.innerText=" ",s}destroy(t){let e=document.getElementById(N.style_id);e&&e.remove(),super.destroy(t)}},B=N;B.style_id="pulse-widget-style";var ht=require("@codemirror/view"),I=class extends ht.WidgetType{constructor(t,e,i,a){super();this.search_position=i,this.style=a,this.text=e,this.idx=t}provide_text(){return this.style.capitalize?this.text.toUpperCase():this.text.toLowerCase()}toDOM(t){let i=Array(this.style.offset).fill(" ").reduce((c,u)=>c+u,"")+this.provide_text().substring(this.style.offset),a=this.search_position.coord.left-this.search_position.origin.left,s=this.search_position.coord.top-this.search_position.origin.top,n=document.createElement("span");return n.className="blaze-jump-area-tag",n.style.backgroundColor=`${this.style.bg}`,n.style.color=`${this.style.text}`,n.style.borderColor=`${this.style.border}`,n.style.zIndex=`${5e3+this.idx}`,n.style.left=`${a}px`,n.style.top=`${s}px`,n.innerText=i,n}};var _t=require("@codemirror/state"),Z=class{constructor(){this.decorations=j.Decoration.none;this.local_id=Z.id_counter++,y.state.plugin_draw_observers||(y.state.plugin_draw_observers=[]),y.state.plugin_draw_observers.push({id:`${this.local_id}`,fn:()=>this.build_decorations()})}update(r){y.state.editor_callback&&y.state.editor_callback(r.view)}destroy(){if(y.state.plugin_draw_observers)for(let r of y.state.plugin_draw_observers)r.id===`${this.local_id}`&&y.state.plugin_draw_observers.remove(r)}build_decorations(){var i,a,s,n;let r=y.state.positions,t=y.state.pointer;if(!t&&!(r&&r.length>0)){this.decorations=j.Decoration.none;return}let e=new _t.RangeSetBuilder;if(r&&r.length>0){let c=-1,u=null,_=[];for(let g of r){let b=g.coord.top;(u===null||!b||u!==b)&&(_.push([]),u=b,c++),_[c].push(g)}let d=0;for(let g of r)e.add(g.index_s,g.index_s,j.Decoration.widget({widget:new I(d++,g.name,g,{...(a=(i=y.state).style_provider)==null?void 0:a.call(i)})}))}else t&&e.add(t.index_s,t.index_s,j.Decoration.widget({widget:new B(t,{...(n=(s=y.state).pulse_provider)==null?void 0:n.call(s)}),inclusive:!1}));this.decorations=e.finish()}},q=Z;q.id_counter=0;var zt={decorations:h=>h.decorations,eventObservers:{keydown:(h,r)=>{y.state.editor_callback&&y.state.editor_callback(r)}}},dt=j.ViewPlugin.fromClass(q,zt);var K=require("obsidian");var J={bj:"BlazeJump",mode:"BlazeMode",word_start:"Word start",word_end:"Word end",any_char:"Any character",line_start:"Line start",line_end:"Line end",def_mode:"Default mode",def_mode_desc:"Default jump mode in toggle-n-jump action",keyboard_heuristic:"Keyboard heuristic",keyboard_heuristic_desc:"Heuristic used for labeling results of indexing",keyboard_layout_main:"Layout Main",keyboard_layout_main_desc:"Main keyboard layout, must be at least 2 characters long",keyboard_layouts:"Keyboard",keyboard_recognize:"Recognize layout",keyboard_recognize_desc:"Try to automatically recognize keyboard layout",keyboard_arrows:"Cycle through keyboard layouts",keyboard_arrows_desc:"Use arrow keys to cycle through keyboard layouts",layout:"Layout",add_layout:"Add layout",remove_layout:"Remove layout",ignored_chars:"Excluded characters",ignored_chars_desc:"Set of characters excluded from result labels",search_depth:"Search depth",search_depth_desc:"Maximum size of the spiral. Value 0 mean no limit.",opaque:"Opaque",status_color:"Status color",status_color_bg:"Color status background",tag_bg:"Tag background",tag_fg:"Tag foreground",tag_border:"Tag border",color_bg:"background color",color_fg:"foreground color",border_color:"border color",pulse:"Pulse",pulse_start_duration:"On Start pulse duration",value_ms:"Value in milliseconds",duration_ms:"Duration in ms",enable:"Enable",pulse_jump_duration:"On Jump pulse duration",pulse_jump_color:"On Jump pulse color",pulse_jump_color_desc:"Pulse color of area under caret after jump",miscellaneous:"Miscellaneous",special_chars:"Special characters",special_chars_exceptions:"Characters ignored when performing search on words",not_found_msg:"Nothing found message",not_found_msg_desc:"Generic message shown when nothing found",dim_editor_style:"Dim editor style",dim_editor_style_desc:"Dims editor when search, drastically improves readability",convert_utf8:"Convert Unicode to ASCII",convert_utf8_desc:"For example: \xDC -> U",auto_jump:"Auto jump",auto_jump_desc:"Jump automatically whenever there is only single candidate",disable_spellcheck:"Disable spellcheck",disable_spellcheck_desc:"Disable spellcheck in editor when searching",disable:"Disable",capitalize_tags:"Capitalize text inside tags",capitalize_tags_desc:"May improve readability",jump_to_word_end:"Jump to the end at word-end",jump_to_word_end_desc:"Jumps to the end of the word in 'Word end' mode",reset:"Reset",reset_defaults:"Reset defaults",command_toggle:"Toggle and jump",command_word_start:"Jump to words start",command_word_end:"Jump to words end",command_any_char:"Jump to any",command_abort:"Abort search",command_line_start:"Jump to line",command_line_end:"Jump to the line end",command_layout:"Switch layout"};var pt=require("obsidian"),At={en:J},R=()=>{try{let h=At[`${pt.moment.locale()}`.toLowerCase()];return h!=null?h:(console.warn("Using fallback language"),J)}catch(h){return console.error("Cannot provide translations error, using fallback option",h),J}};var jt={default_action:"start",keyboard_heuristic:"spiral",keyboard_layout_main:"1234567890 qwertyuiop asdfghjkl zxcvbnm",keyboard_layout_custom:[],keyboard_ignored:"",keyboard_depth:2,keyboard_recognize:!0,keyboard_arrows_switch:!0,status_color_fallback:"#FF5733",status_color_bg:"#FFFFFF00",status_color_start:"#FF5733",status_color_end:"#0000FF",status_color_any:"#008000",status_color_line:"#FF00FF",status_color_terminator:"#696969",search_color_text_start:"#FF5733",search_color_text_end:"#0000FF",search_color_text_any:"#00FFFF",search_color_bg_start:"#FFFF00",search_color_bg_end:"#FFFF00",search_color_bg_any:"#800080",search_dim_enabled:!0,search_dim_style:"color: var(--text-faint);",search_spellcheck_disable:!0,search_jump_pulse:!0,search_jump_pulse_color:"#FF0000",search_jump_pulse_duration:.15,search_start_pulse:!0,search_start_pulse_duration:.15,exceptions:"!?@#$%^&*()<>[]{}/\\|_+-=~.,;:'\"`",search_not_found_text:"\u{1F6AB}",convert_utf8_to_ascii:!1,auto_jump_on_single:!1,capitalize_tags_labels:!1,jump_after_word_on_end:!0},U=class extends K.PluginSettingTab{constructor(t,e){super(t,e);this.difference=!1;this.initialized=!1;this.plugin=e}get lang(){return R()}getSettings(){return this.settings}async initialize(){try{console.debug("settings initialization"),await this.loadSettings()}catch(t){console.error(t)}return this.initialized=!0,this}setCallback(t){this.refresh_call=t}display(){var g,b;if(this.difference=!1,!this.initialized)throw console.error("Settings are not initialized"),"Should call initialize() before!";let t=["start","end","any","line","terminator"],e={[t[0]]:this.lang.word_start,[t[1]]:this.lang.word_end,[t[2]]:this.lang.any_char,[t[3]]:this.lang.line_start,[t[4]]:this.lang.line_end},{containerEl:i}=this;if(i.empty(),this.ns(this.lang.def_mode,"default_action").setDesc(this.lang.def_mode_desc).addDropdown(o=>o.addOption("start",e.start).addOption("end",e.end).addOption("any",e.any).setValue(this.settings.default_action).onChange(async l=>{await this.saveProperty("default_action",l),this.hide(),this.display()})),this.ns(this.lang.keyboard_layouts).setHeading(),this.ns(this.lang.keyboard_heuristic,"keyboard_heuristic").setDesc(this.lang.keyboard_heuristic_desc).addDropdown(o=>{for(let l of nt())o.addOption(l,l);return o.setValue(this.settings.keyboard_heuristic),o.onChange(async l=>{await this.saveProperty("keyboard_heuristic",l),this.hide(),this.display()}),o}),this.settings.keyboard_heuristic==="spiral"){let o=this.ns(this.lang.search_depth,"keyboard_depth",!0).setDesc(this.lang.search_depth_desc).addText(l=>l.setValue(`${this.settings.keyboard_depth}`).onChange(async p=>{try{await this.saveProperty("keyboard_depth",Number(p))}catch(m){console.error(m)}finally{this.toggle_defaults(o,!0)}}))}let a=this.ns(this.lang.ignored_chars,"keyboard_ignored",!0).setDesc(this.lang.ignored_chars_desc).addText(o=>o.setValue(this.settings.keyboard_ignored).onChange(async l=>{await this.saveProperty("keyboard_ignored",l),this.toggle_defaults(a,!0)})),s=this.ns(this.lang.keyboard_layout_main,"keyboard_layout_main",!0);s.setDesc(this.lang.keyboard_layout_main_desc),s.addTextArea(o=>{var l;return o.setValue(((l=this.settings.keyboard_layout_main)!=null?l:"").trim().replace(/\s+/g,`
`)),o.onChange(async p=>{await this.saveProperty("keyboard_layout_main",p),this.toggle_defaults(s,!0)})});for(let o=0;o<((g=this.settings.keyboard_layout_custom)==null?void 0:g.length);o++){let l=(b=this.settings.keyboard_layout_custom[o])!=null?b:"";this.ns(`${this.lang.layout} ${o+1}`).addExtraButton(p=>p.setIcon("trash").setTooltip(this.lang.remove_layout).onClick(async()=>{this.settings.keyboard_layout_custom.splice(o,1),await this.saveProperty("keyboard_layout_custom",this.settings.keyboard_layout_custom),this.hide(),this.display()})).addTextArea(p=>p.setValue(l.trim().replace(/\s+/g,`
`)).onChange(async m=>{await this.saveProperty("keyboard_layout_custom",m,o)}))}new K.Setting(i).addExtraButton(o=>{var l,p;return o.setIcon("circle-plus").setTooltip(this.lang.add_layout).setDisabled(((p=(l=this.settings.keyboard_layout_custom)==null?void 0:l.length)!=null?p:0)>=10).onClick(async()=>{this.settings.keyboard_layout_custom.push(""),await this.saveProperty("keyboard_layout_custom",this.settings.keyboard_layout_custom),this.hide(),this.display()})}),this.ns(this.lang.pulse).setHeading();let n=this.ns(this.lang.pulse_start_duration,["search_start_pulse","search_start_pulse_duration"],!0).setDesc(this.lang.value_ms).addToggle(o=>o.setValue(this.settings.search_start_pulse===!0).setTooltip(this.lang.enable).onChange(async l=>{await this.saveProperty("search_start_pulse",l),this.hide(),this.display()})).addText(o=>{var l;return o.setValue(`${((l=this.settings.search_start_pulse_duration)!=null?l:0)*1e3}`).setDisabled(this.settings.search_start_pulse!==!0).setPlaceholder(this.lang.duration_ms).onChange(async p=>{try{await this.saveProperty("search_start_pulse_duration",Number(p)/1e3)}catch(m){console.error(m)}finally{this.toggle_defaults(n,!0)}})}),c=this.ns(this.lang.pulse_jump_duration,["search_jump_pulse","search_jump_pulse_duration"],!0).setDesc(this.lang.value_ms).addToggle(o=>o.setValue(this.settings.search_jump_pulse===!0).setTooltip(this.lang.enable).onChange(async l=>{await this.saveProperty("search_jump_pulse",l),this.hide(),this.display()})).addText(o=>{var l;return o.setValue(`${((l=this.settings.search_jump_pulse_duration)!=null?l:0)*1e3}`).setDisabled(this.settings.search_jump_pulse!==!0).setPlaceholder(this.lang.duration_ms).onChange(async p=>{try{await this.saveProperty("search_jump_pulse_duration",Number(p)/1e3)}catch(m){console.error(m)}finally{this.toggle_defaults(c,!0)}})});this.ns(this.lang.pulse_jump_color,"search_jump_pulse_color").setDesc(this.lang.pulse_jump_color_desc).addToggle(o=>o.setTooltip(this.lang.opaque).setValue(this.is_opaque("search_jump_pulse_color")).onChange(async l=>{await this.saveProperty("search_jump_pulse_color",this.make_transparent("search_jump_pulse_color",!l)),this.hide(),this.display()})).addColorPicker(o=>o.setValue(this.settings.search_jump_pulse_color).setDisabled(!this.is_opaque("search_jump_pulse_color")).onChange(async l=>{await this.saveProperty("search_jump_pulse_color",l),this.hide(),this.display()})),this.ns(this.lang.miscellaneous).setHeading();let u=this.ns(this.lang.special_chars,"exceptions",!0).setDesc(this.lang.special_chars_exceptions).addToggle(o=>o.setValue(this.settings.exceptions!==void 0).setTooltip(this.lang.enable).onChange(async l=>{l?await this.resetProperty("exceptions"):await this.saveProperty("exceptions",void 0),this.hide(),this.display()})).addText(o=>{var l;return o.setValue((l=this.settings.exceptions)!=null?l:"").setDisabled(this.settings.exceptions===void 0).onChange(async p=>{await this.saveProperty("exceptions",p),this.toggle_defaults(u,!0)})}),_=this.ns(this.lang.not_found_msg,"search_not_found_text",!0).setDesc(this.lang.not_found_msg_desc).addToggle(o=>o.setValue(this.settings.search_not_found_text!==void 0).setTooltip(this.lang.enable).onChange(async l=>{l?await this.resetProperty("search_not_found_text"):await this.saveProperty("search_not_found_text",void 0),this.hide(),this.display()})).addText(o=>{var l;return o.setValue((l=this.settings.search_not_found_text)!=null?l:"").setDisabled(this.settings.search_not_found_text===void 0).onChange(async p=>{await this.saveProperty("search_not_found_text",p),this.toggle_defaults(_,!0)})}),d=this.ns(this.lang.dim_editor_style,["search_dim_enabled","search_dim_style"],!0).setDesc(this.lang.dim_editor_style_desc).addToggle(o=>o.setValue(this.settings.search_dim_enabled===!0).setTooltip(this.lang.enable).onChange(async l=>{await this.saveProperty("search_dim_enabled",l),this.hide(),this.display()})).addTextArea(o=>{var l;return o.setValue(((l=this.settings.search_dim_style)!=null?l:"").trim()).setDisabled(this.settings.search_dim_enabled!==!0).onChange(async p=>{await this.saveProperty("search_dim_style",p),this.toggle_defaults(d,!0)})});this.ns(this.lang.convert_utf8,"convert_utf8_to_ascii").setDesc(this.lang.convert_utf8_desc).addToggle(o=>o.setValue(this.settings.convert_utf8_to_ascii===!0).setTooltip(this.lang.enable).onChange(async l=>{await this.saveProperty("convert_utf8_to_ascii",l),this.hide(),this.display()})),this.ns(this.lang.auto_jump,"auto_jump_on_single").setDesc(this.lang.auto_jump_desc).addToggle(o=>o.setValue(this.settings.auto_jump_on_single===!0).setTooltip(this.lang.enable).onChange(async l=>{await this.saveProperty("auto_jump_on_single",l),this.hide(),this.display()})),this.ns(this.lang.disable_spellcheck,"search_spellcheck_disable").setDesc(this.lang.disable_spellcheck_desc).addToggle(o=>o.setValue(this.settings.search_spellcheck_disable===!0).setTooltip(this.lang.disable).onChange(async l=>{await this.saveProperty("search_spellcheck_disable",l),this.hide(),this.display()})),this.ns(this.lang.capitalize_tags,"capitalize_tags_labels").setDesc(this.lang.capitalize_tags_desc).addToggle(o=>o.setValue(this.settings.capitalize_tags_labels===!0).setTooltip(this.lang.enable).onChange(async l=>{await this.saveProperty("capitalize_tags_labels",l),this.hide(),this.display()})),this.ns(this.lang.jump_to_word_end,"jump_after_word_on_end").setDesc(this.lang.jump_to_word_end_desc).addToggle(o=>o.setValue(this.settings.jump_after_word_on_end===!0).setTooltip(this.lang.enable).onChange(async l=>{await this.saveProperty("jump_after_word_on_end",l),this.hide(),this.display()})),this.ns(this.lang.keyboard_recognize,"keyboard_recognize").setDesc(this.lang.keyboard_recognize_desc).addToggle(o=>o.setValue(this.settings.keyboard_recognize===!0).setTooltip(this.lang.enable).onChange(async l=>{await this.saveProperty("keyboard_recognize",l),this.hide(),this.display()})),this.ns(this.lang.keyboard_arrows,"keyboard_arrows_switch").setDesc(this.lang.keyboard_arrows_desc).addToggle(o=>o.setValue(this.settings.keyboard_arrows_switch===!0).setTooltip(this.lang.enable).onChange(async l=>{await this.saveProperty("keyboard_arrows_switch",l),this.hide(),this.display()})),this.ns(this.lang.status_color).setHeading(),this.ns(this.lang.status_color_bg,"status_color_bg").addToggle(o=>o.setTooltip(this.lang.opaque).setValue(this.is_opaque("status_color_bg")).onChange(async l=>{await this.saveProperty("status_color_bg",this.make_transparent("status_color_bg",!l)),this.hide(),this.display()})).addColorPicker(o=>o.setValue(this.settings.status_color_bg).setDisabled(!this.is_opaque("status_color_bg")).onChange(async l=>{await this.saveProperty("status_color_bg",l),this.hide(),this.display()}));for(let o of t)this.ns(`${this.lang.status_color} ${e[o]}`,`status_color_${o}`).addToggle(l=>l.setTooltip(this.lang.opaque).setValue(this.is_opaque(`status_color_${o}`)).onChange(async p=>{await this.saveProperty(`status_color_${o}`,this.make_transparent(`status_color_${o}`,!p)),this.hide(),this.display()})).addColorPicker(l=>l.setValue(this.settings[`status_color_${o}`]).setDisabled(!this.is_opaque(`status_color_${o}`)).onChange(async p=>{await this.saveProperty(`status_color_${o}`,p),this.hide(),this.display()}));this.ns(this.lang.tag_bg).setHeading();for(let o of t)this.ns(`${e[o]} ${this.lang.color_bg}`,`search_color_bg_${o}`).addToggle(l=>l.setTooltip(this.lang.opaque).setValue(this.is_opaque(`search_color_bg_${o}`)).onChange(async p=>{await this.saveProperty(`search_color_bg_${o}`,this.make_transparent(`search_color_bg_${o}`,!p)),this.hide(),this.display()})).addColorPicker(l=>l.setValue(this.settings[`search_color_bg_${o}`]).setDisabled(!this.is_opaque(`search_color_bg_${o}`)).onChange(async p=>{await this.saveProperty(`search_color_bg_${o}`,p),this.hide(),this.display()}));this.ns(this.lang.tag_fg).setHeading();for(let o of t)this.ns(`${e[o]} ${this.lang.color_fg}`,`search_color_text_${o}`).addToggle(l=>l.setTooltip(this.lang.opaque).setValue(this.is_opaque(`search_color_text_${o}`)).onChange(async p=>{await this.saveProperty(`search_color_text_${o}`,this.make_transparent(`search_color_text_${o}`,!p)),this.hide(),this.display()})).addColorPicker(l=>l.setValue(this.settings[`search_color_text_${o}`]).setDisabled(!this.is_opaque(`search_color_text_${o}`)).onChange(async p=>{await this.saveProperty(`search_color_text_${o}`,p),this.hide(),this.display()}));this.ns(this.lang.tag_border).setHeading();for(let o of t)this.ns(`${e[o]} ${this.lang.border_color}`,`search_color_border_${o}`).addToggle(l=>l.setTooltip(this.lang.opaque).setValue(this.is_opaque(`search_color_border_${o}`)).onChange(async p=>{await this.saveProperty(`search_color_border_${o}`,this.make_transparent(`search_color_border_${o}`,!p)),this.hide(),this.display()})).addColorPicker(l=>l.setValue(this.settings[`search_color_border_${o}`]).setDisabled(!this.is_opaque(`search_color_border_${o}`)).onChange(async p=>{await this.saveProperty(`search_color_border_${o}`,p),this.hide(),this.display()}))}async loadSettings(){var i,a,s,n;let t=["start","end","any","line","terminator"],e={...jt};for(let c of t){let u=(i=e[`status_color_${c}`])!=null?i:e.status_color_fallback;e[`search_color_bg_${c}`]=(a=e[`search_color_bg_${c}`])!=null?a:"#FFFFFF",e[`search_color_text_${c}`]=(s=e[`search_color_text_${c}`])!=null?s:u,e[`search_color_border_${c}`]=(n=e[`search_color_text_${c}`])!=null?n:u}this.default_settings={...e},this.settings=Object.assign({},this.default_settings,await this.plugin.loadData())}async resetProperty(t){var e;console.debug("resetProperty",t),!(!t||t.trim().length<=0)&&(this.settings[t]=this.default_settings[t],await this.plugin.saveData(this.settings),(e=this.refresh_call)==null||e.call(this))}async saveProperty(t,e,i=-1){var a;console.debug("saveProperty:",t,e,i>=0?i:""),!(!t||t.trim().length<=0)&&(i>=0?(this.settings[t][i]=e,await this.plugin.saveData(this.settings)):(this.settings[t]=e,await this.plugin.saveData(this.settings)),(a=this.refresh_call)==null||a.call(this))}toggle_defaults(t,e=!1){var i,a,s,n;return e?(n=(s=t.components[0])==null?void 0:s.extraSettingsEl)==null||n.show():(a=(i=t.components[0])==null?void 0:i.extraSettingsEl)==null||a.hide(),t}with_reset(t,e,i=!1){var s,n,c,u,_,d,g;let a=this.lang.reset_defaults;for(let b of t){let o=this.default_settings[b],l=this.settings[b];if(`${o}`!=`${l}`&&!this.difference&&(this.difference=!0),`${o}`!=`${l}`||i){if(((c=(n=(s=e.components)==null?void 0:s[0])==null?void 0:n.extraSettingsEl)==null?void 0:c.ariaLabel)===a||((g=(d=(_=e.components)==null?void 0:_[((u=e.components)==null?void 0:u.length)-1])==null?void 0:d.extraSettingsEl)==null?void 0:g.ariaLabel)===a)return e;let p=e.addExtraButton(m=>m.setIcon("rotate-ccw").setTooltip(a).onClick(async()=>{for(let f of t)await this.resetProperty(f);this.hide(),this.display()}));return i?this.toggle_defaults(p,`${o}`!=`${l}`):p}}return e}is_opaque(t){let e=`${this.settings[t]}`;return e.startsWith("#")&&e.length<9?!0:e.startsWith("#")&&e.length===9&&e.endsWith("FF")}make_transparent(t,e){let i=`${this.settings[t]}`;return i?i.startsWith("#")&&i.length===7?`${i}${e?"00":""}`:i.startsWith("#")&&i.length===9?`${i.substring(0,7)}${e?"00":""}`:i:e?"#FFFFFF00":"#FFFFFFFF"}ns(t,e,i=!1){let{containerEl:a}=this,s=new K.Setting(a).setName(t);return e?this.with_reset(Array.isArray(e)?[...e]:[e],s,i):s}};var W=class extends z.Plugin{constructor(){super(...arguments);this.mode=void 0;this.current_char=void 0;this.override_recognize=!1;this.layout_def=0;this.layout_cur=0;this.layout_num=1;this.offset=0}get settings(){return this.plugin_settings.getSettings()}get lang(){return R()}async initialize(){var e;let t=[this.settings.keyboard_layout_main,...(e=this.settings.keyboard_layout_custom)==null?void 0:e.filter(i=>i.trim()!=="")];this.layout_num=t.length,this.layout_cur=0,this.layout_def=0,this.search_tree=new F(at(this.settings.keyboard_heuristic),t,this.settings.keyboard_ignored,this.settings.keyboard_depth),this.layoutSet(this.layout_cur)}async onload(){try{this.plugin_settings=await new U(this.app,this).initialize(),this.plugin_settings.setCallback(()=>this.initialize()),await this.initialize(),y.state.style_provider=()=>this.resolveSearchColor(),y.state.pulse_provider=()=>this.resolvePulseStyle(),y.state.editor_callback=t=>{t.visibleRanges.length<=0||(this.range_from=t.visibleRanges[0].from,this.range_to=t.visibleRanges[t.visibleRanges.length-1].to)},this.registerEditorExtension(dt),this.addCommand({id:"toggle",name:this.lang.command_toggle,editorCallback:(t,e)=>this.blazeAction(t,e)}),this.addCommand({id:"start",name:this.lang.command_word_start,editorCallback:(t,e)=>this.startAction(t,e)}),this.addCommand({id:"end",name:this.lang.command_word_end,editorCallback:(t,e)=>this.endAction(t,e)}),this.addCommand({id:"any",name:this.lang.command_any_char,editorCallback:(t,e)=>this.anyAction(t,e)}),this.addCommand({id:"abort",name:this.lang.command_abort,editorCallback:t=>this.resetAction(t)}),this.addCommand({id:"line",name:this.lang.command_line_start,editorCallback:(t,e)=>this.beginningAction(t,e)}),this.addCommand({id:"terminator",name:this.lang.command_line_end,editorCallback:(t,e)=>this.terminatorAction(t,e)}),this.addCommand({id:"layout",name:this.lang.command_layout,editorCallback:(t,e)=>this.layoutAction(t,e)})}catch(t){console.error(t)}finally{this.addSettingTab(this.plugin_settings)}}onunload(){y.state={},this.resetAction(),this.layoutClear()}redraw(t){var e;(e=this.app.workspace.getActiveViewOfType(z.MarkdownView))==null||e.previewMode.rerender(!0),y.state.plugin_draw_callback&&y.state.plugin_draw_callback(),t&&t.cm.dispatch()}resolveStatusColor(){var t;return this.settings[`status_color_${(t=this.mode)!=null?t:this.settings.default_action}`]}resolveSearchColor(){var i,a,s,n,c,u;let t=this.settings,e=this.resolveStatusColor();return{capitalize:this.settings.capitalize_tags_labels===!0,bg:(a=t[`search_color_bg_${(i=this.mode)!=null?i:this.settings.default_action}`])!=null?a:"#FFFFFF",text:(n=t[`search_color_text_${(s=this.mode)!=null?s:this.settings.default_action}`])!=null?n:e,border:(u=t[`search_color_border_${(c=this.mode)!=null?c:this.settings.default_action}`])!=null?u:e,offset:this.offset}}resolvePulseStyle(){var t,e;return{duration:(t=this.settings.search_jump_pulse_duration)!=null?t:.15,bg:(e=this.settings.search_jump_pulse_color)!=null?e:"red"}}statusSet(t){var e,i,a;this.statusClear(),this.statusBar=this.addStatusBarItem(),this.statusBar.createEl("span",{text:`${t} `,cls:"blaze-jump-status-bar",attr:{style:`
			background-color: ${(e=this.settings.status_color_bg)!=null?e:"#FFFFFF00"}; 
			border: thin solid ${(i=this.resolveStatusColor())!=null?i:this.settings.status_color_fallback};
			color: ${(a=this.resolveStatusColor())!=null?a:this.settings.status_color_fallback};
			`}})}layoutSet(t){let e=t>0?`${t}`:"M";if(!this.layoutBar)this.layoutBar=this.addStatusBarItem(),this.layoutBar.addEventListener("click",()=>this.layoutAction());else{let i=this.layoutBar.childNodes;for(let a=0;a<i.length;a++)this.layoutBar.removeChild(i[a])}this.layoutBar.createEl("span",{text:e,cls:"blaze-jump-layout-bar"})}statusClear(){var t;(t=this.statusBar)==null||t.remove(),this.statusBar=void 0}layoutClear(){var t;(t=this.layoutBar)==null||t.remove(),this.layoutBar=void 0}toggleMode(t){let e={start:"end",end:"any",any:"start"},i=this.mode?e[this.mode]:this.settings.default_action;this.resetAction(),this.mode=i}resetLayout(){this.layout_cur=this.layout_def,this.layoutSet(this.layout_cur)}toggleLayout(t=1){this.layout_cur+=t,this.layout_cur>=this.layout_num&&(this.layout_cur=0),this.layout_cur<0&&(this.layout_cur=this.layout_num-1),this.layoutSet(this.layout_cur)}toggleLineMode(t,e){let i=this.mode;return this.resetAction(e),this.mode=t?"line":"terminator",i!==this.mode}toggleDim(t){var a;if(!this.settings.search_dim_enabled)return;let e="dim-editor-style",i=document.getElementById(e);if(t){if(!i){let s=document.createElement("style");s.id=e,s.textContent=`
                    .cm-content {
                      ${(a=this.settings.search_dim_style)!=null?a:""}
                    }
                `,document.head.appendChild(s)}}else i&&i.remove()}toggleSpellcheck(t){if(!this.settings.search_spellcheck_disable)return;let e=document.getElementsByClassName("cm-content");if(e)for(let i=0;i<e.length;i++){let a=e[i],s=a.getAttribute("spellcheck");if(!(!s||s.trim()==="")){if(!t){this.spellcheck=s,a.setAttribute("spellcheck","false");return}this.spellcheck&&a.setAttribute("spellcheck",this.spellcheck);return}}}pulseInit(t){var a;if(!this.settings.search_start_pulse)return;let e="pulse-once-init",i=document.getElementById(e);if(!t&&i){i.remove();return}if(t&&!i){let s=document.createElement("style");s.id=e,s.textContent=`                  
                    .cm-content {
                      animation: blaze-jump-content-pulse ${(a=this.settings.search_start_pulse_duration)!=null?a:.15}s 1 forwards;
                    }
                `,document.head.appendChild(s)}}jumpTo(t,e){var i;t.setCursor(e.start),this.settings.search_jump_pulse&&(y.state.pointer=e,y.state.positions=void 0,this.redraw(t),window.setTimeout(()=>{y.state.pointer=void 0,y.state.plugin_draw_callback&&y.state.plugin_draw_callback()},((i=this.settings.search_jump_pulse_duration)!=null?i:0)*1e3))}resetAction(t,e=!0){e&&(this.statusClear(),this.toggleDim(!1),this.pulseInit(!1),this.toggleSpellcheck(!0),this.search_tree.reset(),this.mode=void 0,this.offset=0,this.callback_mouse_reset&&(window.removeEventListener("click",this.callback_mouse_reset),window.removeEventListener("contextmenu",this.callback_mouse_reset),window.removeEventListener("auxclick",this.callback_mouse_reset)),this.override_recognize=!1,this.callback_mouse_reset=null,this.current_char=void 0,this.resetLayout()),this.callback_start_search&&window.removeEventListener("keydown",this.callback_start_search),this.callback_provided_input&&window.removeEventListener("keydown",this.callback_provided_input),this.callback_provided_input=null,this.callback_start_search=null,y.state.positions=void 0,y.state.pointer=void 0,y.state.target=void 0}layoutAction(t,e){this.toggleLayout(),this.layout_def=this.layout_cur}blazeAction(t,e){this.resetAction(t,!1),this.toggleMode(t),this.searchAction(t)}startAction(t,e){this.resetAction(t),this.mode="start",this.searchAction(t)}endAction(t,e){this.resetAction(t),this.mode="end",this.searchAction(t)}anyAction(t,e){this.resetAction(t),this.mode="any",this.searchAction(t)}beginningAction(t,e){this.resetAction(t),this.mode="line",this.lineAction(t)}terminatorAction(t,e){this.resetAction(t),this.mode="terminator",this.lineAction(t)}lineAction(t){this.statusSet(`${this.lang.mode}: `),this.toggleSpellcheck(!1),this.pulseInit(!0),this.toggleDim(!0),t.blur();let e;try{if(e=this.performLineSearch(t),!e||e.length<=0){this.resetAction(t),t.focus(),this.redraw(t);return}}catch(s){console.error(s),this.resetAction(t),t.focus(),this.redraw(t);return}let i=s=>{s&&(s.preventDefault(),s.stopPropagation());try{this.resetAction(t),t.focus(),window.removeEventListener("click",i),window.removeEventListener("contextmenu",i),window.removeEventListener("auxclick",i)}finally{this.redraw(t)}},a=s=>{if(window.removeEventListener("keydown",a),s.preventDefault(),s.stopPropagation(),s.which===16||s.keyCode===16||`${s.key}`.toLowerCase()==="shift"){this.callback_provided_input=a,window.addEventListener("keydown",a,{once:!0});return}if(s.keyCode===27||s.which===27||`${s.key}`.toLowerCase()==="escape"||`${s.code}`.toLowerCase()==="escape"){this.resetAction(t),t.focus(),this.redraw(t);return}if((s.which===38||s.keyCode===38||`${s.code}`.toLowerCase()==="arrowup"||`${s.key}`.toLowerCase()==="arrowup")&&this.settings.keyboard_arrows_switch){let n=this.layout_cur,c=this.mode;this.resetAction(t),this.layout_cur=n,this.mode=c,this.toggleLayout(1),this.lineAction(t),this.redraw(t);return}if((s.which===40||s.keyCode===40||`${s.code}`.toLowerCase()==="arrowdown"||`${s.key}`.toLowerCase()==="arrowdown")&&this.settings.keyboard_arrows_switch){let n=this.layout_cur,c=this.mode;this.resetAction(t),this.layout_cur=n,this.mode=c,this.toggleLayout(-1),this.lineAction(t),this.redraw(t);return}if(s.which===37||s.keyCode===37||`${s.code}`.toLowerCase()==="arrowleft"||`${s.key}`.toLowerCase()==="arrowleft"){let n=this.layout_cur,c=this.toggleLineMode(!0,t);this.settings.keyboard_arrows_switch&&!c&&(this.layout_cur=n,this.toggleLayout()),this.lineAction(t),this.redraw(t);return}if(s.which===39||s.keyCode===39||`${s.code}`.toLowerCase()==="arrowright"||`${s.key}`.toLowerCase()==="arrowright"){let n=this.layout_cur,c=this.toggleLineMode(!1,t);this.settings.keyboard_arrows_switch&&!c&&(this.layout_cur=n,this.toggleLayout()),this.lineAction(t),this.redraw(t);return}try{let n=`${s.key}`.toLowerCase();this.search_tree.narrow(n),this.offset+=1;let c=this.freeze_positions();this.resetAction(t,c.length<=1),c.length>1?(this.statusSet(`${this.lang.mode}: ${n}`),y.state.positions=[...c],this.callback_provided_input=a,window.addEventListener("keydown",a,{once:!0})):c.length===1?(this.jumpTo(t,c[0]),t.focus()):this.settings.search_not_found_text&&this.settings.search_not_found_text.trim()!==""&&(t.focus(),new z.Notice(this.settings.search_not_found_text))}catch(n){throw console.error(n),this.resetAction(t),t.focus(),n}finally{this.redraw(t)}};y.state.positions=[...e],y.state.pointer=void 0,this.redraw(t),this.callback_provided_input=a,this.callback_mouse_reset=i,window.addEventListener("keydown",a,{once:!0}),window.addEventListener("click",i,{once:!0}),window.addEventListener("contextmenu",i,{once:!0}),window.addEventListener("auxclick",i,{once:!0})}searchAction(t){this.statusSet(`${this.lang.mode}: `),this.pulseInit(!0),t.blur();let e=s=>{s&&(s.preventDefault(),s.stopPropagation());try{this.resetAction(t),t.focus(),window.removeEventListener("click",e),window.removeEventListener("contextmenu",e),window.removeEventListener("auxclick",e)}finally{this.redraw(t)}},i=s=>{try{if(window.removeEventListener("keydown",i),s.preventDefault(),s.stopPropagation(),s.which===16||s.keyCode===16||`${s.key}`.toLowerCase()==="shift"){this.callback_provided_input=i,window.addEventListener("keydown",i,{once:!0});return}if(s.keyCode===27||s.which===27||`${s.key}`.toLowerCase()==="escape"||`${s.code}`.toLowerCase()==="escape"){this.resetAction(t);return}if(s.which===37||s.keyCode===37||`${s.code}`.toLowerCase()==="arrowleft"||`${s.key}`.toLowerCase()==="arrowleft"){this.toggleLineMode(!0,t),this.lineAction(t);return}if(s.which===39||s.keyCode===39||`${s.code}`.toLowerCase()==="arrowright"||`${s.key}`.toLowerCase()==="arrowright"){this.toggleLineMode(!1,t),this.lineAction(t);return}if((s.which===38||s.keyCode===38||`${s.code}`.toLowerCase()==="arrowup"||`${s.key}`.toLowerCase()==="arrowup")&&this.settings.keyboard_arrows_switch){let u=this.layout_cur,_=this.current_char,d=this.mode;this.resetAction(t),this.override_recognize=!0,this.layout_cur=u,this.mode=d,this.toggleLayout(1),this.callback_mouse_reset=e,window.addEventListener("click",e,{once:!0}),window.addEventListener("contextmenu",e,{once:!0}),window.addEventListener("auxclick",e,{once:!0}),a({key:_,code:_});return}if((s.which===40||s.keyCode===40||`${s.code}`.toLowerCase()==="arrowdown"||`${s.key}`.toLowerCase()==="arrowdown")&&this.settings.keyboard_arrows_switch){let u=this.layout_cur,_=this.current_char,d=this.mode;this.resetAction(t),this.override_recognize=!0,this.layout_cur=u,this.mode=d,this.toggleLayout(-1),this.callback_mouse_reset=e,window.addEventListener("click",e,{once:!0}),window.addEventListener("contextmenu",e,{once:!0}),window.addEventListener("auxclick",e,{once:!0}),a({key:_,code:_});return}let n=`${s.key}`.toLowerCase();this.offset+=1,this.search_tree.narrow(n);let c=this.freeze_positions();this.resetAction(t,c.length<=1),c.length>1?(this.statusSet(`${this.lang.mode}: ${n}`),y.state.positions=[...c],this.callback_provided_input=i,window.addEventListener("keydown",i,{once:!0})):c.length===1?(t.focus(),this.jumpTo(t,c[0])):this.settings.search_not_found_text&&this.settings.search_not_found_text.trim()!==""&&(t.focus(),new z.Notice(this.settings.search_not_found_text))}catch(n){throw console.error(n),this.resetAction(t),t.focus(),n}finally{this.redraw(t)}},a=s=>{var n,c;if(window.removeEventListener("keydown",a),(n=s==null?void 0:s.preventDefault)==null||n.call(s),(c=s==null?void 0:s.stopPropagation)==null||c.call(s),s.which===16||s.keyCode===16||`${s.key}`.toLowerCase()==="shift"){this.callback_start_search=a,window.addEventListener("keydown",a,{once:!0});return}if(s.keyCode===27||s.which===27||`${s.key}`.toLowerCase()==="escape"||`${s.code}`.toLowerCase()==="escape"){this.resetAction(t),t.focus(),this.redraw(t);return}if((s.which===38||s.keyCode===38||`${s.code}`.toLowerCase()==="arrowup"||`${s.key}`.toLowerCase()==="arrowup")&&this.settings.keyboard_arrows_switch){let u=this.layout_cur,_=this.mode;this.resetAction(t),this.layout_cur=u,this.mode=_,this.toggleLayout(1),this.searchAction(t),this.redraw(t);return}if((s.which===40||s.keyCode===40||`${s.code}`.toLowerCase()==="arrowdown"||`${s.key}`.toLowerCase()==="arrowdown")&&this.settings.keyboard_arrows_switch){let u=this.layout_cur,_=this.mode;this.resetAction(t),this.layout_cur=u,this.mode=_,this.toggleLayout(-1),this.searchAction(t),this.redraw(t);return}if(s.which===37||s.keyCode===37||`${s.code}`.toLowerCase()==="arrowleft"||`${s.key}`.toLowerCase()==="arrowleft"){this.toggleLineMode(!0,t),this.lineAction(t),this.redraw(t);return}if(s.which===39||s.keyCode===39||`${s.code}`.toLowerCase()==="arrowright"||`${s.key}`.toLowerCase()==="arrowright"){this.toggleLineMode(!1,t),this.lineAction(t),this.redraw(t);return}try{this.toggleSpellcheck(!1),this.toggleDim(!0);let u=`${s.key}`.toLowerCase();if(this.current_char=s.key,u.length<=2&&u.trim().length>0){let _=this.performSearch(t,u);if(!_||_.length<=0){this.resetAction(t),t.focus(),this.settings.search_not_found_text&&this.settings.search_not_found_text.trim()!==""&&new z.Notice(this.settings.search_not_found_text);return}if(_.length===1&&this.settings.auto_jump_on_single===!0){this.resetAction(t),t.focus(),this.jumpTo(t,_[0]);return}y.state.positions=[..._],y.state.pointer=void 0,this.statusSet(`${this.lang.mode}: ${u}`),this.callback_provided_input=i,window.addEventListener("keydown",i,{once:!0})}else this.resetAction(t),t.focus()}catch(u){throw console.error(u),this.resetAction(t),t.focus(),u}finally{this.redraw(t)}};this.callback_provided_input=i,this.callback_start_search=a,this.callback_mouse_reset=e,window.addEventListener("keydown",a,{once:!0}),window.addEventListener("click",e,{once:!0}),window.addEventListener("contextmenu",e,{once:!0}),window.addEventListener("auxclick",e,{once:!0})}performLineSearch(t){var b;let e=[...(b=this.settings.exceptions)!=null?b:""],i=t.cm,a=t.offsetToPos(this.range_from),s=t.offsetToPos(this.range_to);if(!a||!s)return this.search_tree.reset(),[];let n=this.layout_cur,c=this.search_tree.mid_layout_char(n),u=a.line,_=s.line,d=null,g=null;for(let o=u;o<=_;o++){let l={line:o,ch:0},p=t.getLine(o),m=p.length;if(m>0)d=i.coordsAtPos(t.posToOffset(l)),g=l;else if(m<=0){if(!d||!g)for(let w=o+1;w<_;w++){let x={line:w,ch:0};if(t.getLine(w).length>0){d=i.coordsAtPos(t.posToOffset(x)),g=x;break}}if(!d||!g)continue;let f={line:o,ch:1},v=t.posToOffset(g),C=i.coordsAtPos(t.posToOffset(l));if(!C)continue;let k=this.calc_offset(t.getLine(g.line),e);this.search_tree.assign(c,{index_e:v+1+k,index_s:v+k,origin:d,coord:C,start:l,end:f},n);continue}if(this.mode==="line"){let f=null;for(let v=0;v<p.length;v++){let C={line:o,ch:v},k=t.posToOffset(C),w=i.coordsAtPos(k);if(!(w!=null&&w.top)||!(f===null||f<w.top))continue;let x={line:o,ch:1+v};this.search_tree.assign(c,{index_e:k+1,index_s:k,origin:d,coord:w,start:C,end:x},n),f=w.top}}else if(this.mode==="terminator"){let f=null;for(let A=0;A<p.length;A++){let gt={line:o,ch:A},yt=t.posToOffset(gt),D=i.coordsAtPos(yt);if(!(D!=null&&D.top)||A<=1||!(f===null||f<D.top))continue;if(f===null){f=D.top;continue}let tt=A-1,et={line:o,ch:tt},mt={line:o,ch:tt+1},Y=t.posToOffset(et),st=i.coordsAtPos(Y);st&&(this.search_tree.assign(c,{index_e:Y+1,index_s:Y,origin:d,coord:st,start:et,end:mt},n),f=D.top)}let v=p.length,C={line:o,ch:v-1},k={line:o,ch:v},w=t.posToOffset(C),x=i.coordsAtPos(w);if(!x)continue;let L=0;for(;;){let A=p[p.length-1-L];if(e.includes(A)){L++;continue}break}this.search_tree.assign(c,{index_e:w+1-L,index_s:w-L,origin:d,coord:x,start:k,end:k},n)}}return this.freeze_positions()}performSearch(t,e){var l;y.state.target=e;let i=[...(l=this.settings.exceptions)!=null?l:""],a=this.settings.jump_after_word_on_end?1:0,s=t.cm,n=this.normalize_text(e.toLowerCase()),u=t.getValue().toLowerCase().substring(this.range_from,this.range_to),_=this.settings.keyboard_recognize&&!this.override_recognize?this.search_tree.recognize_layout(e,this.layout_cur):this.layout_cur;this.settings.keyboard_recognize&&!this.override_recognize&&(this.layout_cur=_,this.layoutSet(_));let d=u.indexOf(n),g=new Date().getTime();for(;d>-1;){let p=t.offsetToPos(d+this.range_from+e.length),m=t.offsetToPos(d+this.range_from),f=s.coordsAtPos(d+this.range_from-m.ch),v=s.coordsAtPos(d+this.range_from);if(!f||!v){d=u.indexOf(n,d+1);continue}let C=this.calc_offset(t.getLine(m.line),i),k={index_e:d+this.range_from-m.ch+e.length+C,index_s:d+this.range_from-m.ch+C,origin:f,coord:v,start:m,end:p};if(this.mode==="any")this.search_tree.assign(n,k,_);else if(this.mode==="start"){let w=t.offsetToPos((d>0?d-1:d)+this.range_from),x=t.getRange(w,p).trim();x.length===1?this.search_tree.assign(n,k,_):x.length===2&&i.some(L=>L===x.at(0))&&this.search_tree.assign(n,k,_)}else if(this.mode==="end"){let w=t.offsetToPos(d+e.length+1+this.range_from),x=t.getRange(m,w).trim();x.length===1?(k.start.ch+=a,this.search_tree.assign(n,k,_)):x.length===2&&i.some(L=>L===x.at(1))&&(k.start.ch+=a,this.search_tree.assign(n,k,_))}d=u.indexOf(n,d+1)}let b=this.freeze_positions(),o=new Date().getTime();return console.debug(`indexing: ${o-g}ms`),console.debug(`found: ${b.length}`),b}calc_offset(t,e){let i=1;for(;i<t.length-1;){let a=t.at(i);if(a&&e.some(s=>s===a)){i+=1;continue}break}return i}freeze_positions(){return this.search_tree.freeze_nodes().map(t=>({...t.value,name:t.full_id.substring(1)})).sort((t,e)=>t.index_s-e.index_s)}normalize_text(t){return this.settings.convert_utf8_to_ascii===!0?t.normalize("NFD").replace(/[\u0300-\u036f]/g,""):t}};

/* nosourcemap */